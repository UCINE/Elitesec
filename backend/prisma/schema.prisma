generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id String @id @default(uuid())

    avatar      Avatar?
    connection  Connection?
    username    String       @unique
    isAdmin     Boolean      @default(false)
    email       String       @unique
    firstBloods Challenge[]
    submissions Submission[]
    teams       Team[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("users")
}

model Avatar {
    id     String @id @default(uuid())
    userId String @unique

    defaultFilename String
    filename        String

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user User @relation(fields: [userId], references: [id])

    @@map("avatars")
}

model Connection {
    id     String @id @default(uuid())
    userId String @unique

    provider   String @default("42")
    providerId String @unique

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user User @relation(fields: [userId], references: [id])

    @@map("connections")
}

model Event {
    id String @id @default(uuid())

    title       String
    description String?
    startAt     DateTime
    endAt       DateTime
    location    String?
    link        String?
    image       String?
    isPublished Boolean      @default(false)
    maxTeamSize Int          @default(1)
    teams       Team[]
    challenges  Challenge[]
    submissions Submission[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("events")
}

model Challenge {
    id           String  @id @default(uuid())
    eventId      String?
    firstBloodId String?

    title       String
    description String?
    image       String?
    score       Int          @default(0)
    flag        String?
    isPublished Boolean      @default(false)
    submissions Submission[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    event      Event? @relation(fields: [eventId], references: [id])
    firstBlood User?  @relation(fields: [firstBloodId], references: [id])

    @@map("challenges")
}

model Submission {
    id          String  @id @default(uuid())
    userId      String
    teamId      String
    eventId     String?
    challengeId String

    score Int @default(0)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user      User      @relation(fields: [userId], references: [id])
    team      Team      @relation(fields: [teamId], references: [id])
    event     Event?    @relation(fields: [eventId], references: [id])
    challenge Challenge @relation(fields: [challengeId], references: [id])

    @@map("submissions")
}

model Team {
    id      String @id @default(uuid())
    ownerId String
    eventId String

    name        String
    description String?
    image       String?
    members     User[]
    submissions Submission[]
    isBanned    Boolean      @default(false)

    event Event? @relation(fields: [eventId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
